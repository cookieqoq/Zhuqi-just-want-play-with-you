<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>
        ç«¹å´åœ°åœ–
    </title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="../styles/game.css">
    <link rel="icon" href="../images/logo.png" type="image/png">
    <script src="scripts/game-redirect.js"></script>

    <style>
        body {
            background-color: #f4f4f4;
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 0;
            padding-top: 120px;
        }

        .mp-wrap {
            display: flex;
            height: calc(100vh - 120px);
            position: relative;
        }

        .mp-aside {
            width: 350px;
            background: white;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
            z-index: 2;
        }

        .mp-map {
            flex-grow: 1;
            background: #e9e9e9;
            position: relative;
            z-index: 1;
        }

        .kf-search-unit {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 2px solid #ddd;
        }

        .kf-search-unit-bar {
            margin-bottom: 10px;
        }

        .kf-search-unit input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .map-list {
            padding: 10px;
        }

        .map-list_item {
            display: flex;
            text-decoration: none;
            color: #333;
            background: #fff;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: 0.3s;
            cursor: pointer;
            border: 1px solid #eee;
        }

            .map-list_item:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            }

        .kf-img {
            width: 110px;
            min-height: 120px;
            flex-shrink: 0;
            background: #eee;
        }

            .kf-img img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .map-list_body {
            padding: 10px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .map-list_tit {
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0;
        }

        .map-addr-text {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
        }

            .map-addr-text i {
                margin-top: 3px;
                margin-right: 5px;
                color: #dc3545;
            }

        .btn-detail {
            font-size: 12px;
            padding: 2px 10px;
            border-radius: 20px;
            width: fit-content;
            margin-top: auto;
        }

        .map-aside_foot {
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: #888;
            background: #f9f9f9;
            border-top: 1px solid #eee;
        }

        .filter-buttons {
            padding: 0 10px 10px 10px;
            display: flex;
            gap: 5px;
        }

            .filter-buttons button {
                flex: 1;
            }

        @media (max-width: 768px) {
            body {
                padding-top: 100px;
            }

            .mp-wrap {
                flex-direction: column;
                height: calc(100vh - 100px);
            }

            .mp-aside {
                width: 100%;
                height: 40vh;
                order: 2;
            }

            .mp-map {
                height: 60vh;
                order: 1;
            }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
    <div class="navbar-image-container">
        <div class="navbar-overlay"></div>
        <div class="navbar-content">
            <a href="../index.html" class="navbar-brand-custom">ç«¹æƒ³ä¸€å´ç© - ç«¹å´åœ°åœ–</a>
            <ul class="navbar-menu">
                <li><a href="index.html">ç«¹å´åœ°åœ–</a></li>
                <li><a href="../comments.html">ç•™è¨€æ¿</a></li>
                <li><a href="../introduction.html">ç«¹å´ç°¡ä»‹</a></li>
                <li><a href="../we/we.html">é—œæ–¼æˆ‘å€‘</a></li>
                <li><a href="../successPlz/index.html">éŠæˆ²å°è¦½</a></li>
            </ul>
            <a href="../home.html" class="back-home-btn">è¿”å›é¦–é </a>
        </div>
    </div>

    <div class="mp-wrap">
        <div class="mp-aside">
            <form class="kf-search-unit">
                <div class="kf-search-unit-bar">
                    <input id="SearchKeyword" type="text" placeholder="æœå°‹æ™¯é»...">
                </div>
            </form>

            <div class="filter-buttons">
                <button type="button" id="btn-scenic" class="btn btn-sm btn-info">
                    <i class="fas fa-mountain"></i> æ™¯é»
                </button>
                <button type="button" id="btn-food" class="btn btn-sm btn-warning text-white">
                    <i class="fas fa-utensils"></i> ç¾é£Ÿ
                </button>
                <button type="button" id="cleanAll" class="btn btn-sm btn-secondary">
                    å…¨éƒ¨
                </button>
            </div>
            <div class="map-aside-content">
                <div class="map-list"></div>
            </div>
            <div class="map-aside_foot">ç«¹å´ç†±é–€æ™¯é»èˆ‡ç¾é£Ÿ</div>
        </div>
        <div id="g-map" class="mp-map"></div>
    </div>

    <script>
        var map;
        var markers = {};
        var redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
        });

        function initMap() {
            map = L.map('g-map').setView([23.50, 120.6], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
        }

        function addSpotByAddress(spot) {
            var $listContainer = $('.map-list');

            var btnHtml = '';
            if (spot.link && spot.link !== '#') {
                btnHtml = `
                        <a href="${spot.link}" target="_blank" class="btn btn-outline-primary btn-sm btn-detail" onclick="event.stopPropagation();">
                            è©³ç´°ä»‹ç´¹ <i class="fas fa-external-link-alt ml-1"></i>
                        </a>`;
            } else {
                btnHtml = `<span class="text-muted" style="font-size:12px;">æš«ç„¡ä»‹ç´¹</span>`;
            }

            var badgeColor = "badge-danger";
            if (spot.type === "ç¾é£Ÿ") {
                badgeColor = "badge-warning";
            }

            var listItemHTML = `
                    <div id="${spot.id}" class="map-list_item" data-type="${spot.type}">
                        <div class="kf-img">
                            <img src="${spot.imgUrl}" alt="${spot.name}" onerror="this.src='https://placehold.co/100x100?text=No+Img'">
                        </div>
                        <div class="map-list_body">
                            <span class="badge ${badgeColor}" style="width:fit-content; margin-bottom:5px;">${spot.type}</span>
                            <div class="map-list_tit">${spot.name}</div>
                            <div class="map-addr-text">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${spot.address_display}</span>
                            </div>
                            ${btnHtml}
                        </div>
                    </div>`;

            $listContainer.append(listItemHTML);

            if (spot.lat && spot.lng) {
                var marker = L.marker([spot.lat, spot.lng], { icon: redIcon }).addTo(map)
                    .bindPopup(`<b>${spot.name}</b><br>${spot.address_display}`);
                markers[spot.id] = { marker: marker, lat: spot.lat, lon: spot.lng };
                $(`#${spot.id}`).on('click', function () {
                    map.flyTo([spot.lat, spot.lng], 16);
                    marker.openPopup();
                });
            } else {
                $.getJSON('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(spot.address_search), function (data) {
                    if (data && data.length > 0) {
                        var lat = data[0].lat;
                        var lon = data[0].lon;
                        var marker = L.marker([lat, lon], { icon: redIcon }).addTo(map)
                            .bindPopup(`<b>${spot.name}</b><br>${spot.address_display}`);
                        markers[spot.id] = { marker: marker, lat: lat, lon: lon };
                        $(`#${spot.id}`).on('click', function () {
                            map.flyTo([lat, lon], 16);
                            marker.openPopup();
                        });
                    }
                }).fail(function () {
                    console.error('åœ°ç†ç·¨ç¢¼è«‹æ±‚å¤±æ•—: ' + spot.name);
                });
            }
        }

        $(function () {
            initMap();

            var mySpots = [
                { id: "spot_01", name: "ç«¹å´è¦ªæ°´å…¬åœ’", address_search: "ç«¹å´è¦ªæ°´å…¬åœ’", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­è¯è·¯", type: "æ™¯é»", imgUrl: "park.jpg", link: "park.html" },
                { id: "spot_02", name: "è¡ŒåƒåŠæ©‹", address_search: "è¡ŒåƒåŠæ©‹", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­æ­£è·¯96è™Ÿ", type: "æ™¯é»", imgUrl: "bridge.jpg", link: "bridge.html" },
                { id: "spot_03", name: "è§€éŸ³ç€‘å¸ƒ", address_search: "å˜‰ç¾©è§€éŸ³ç€‘å¸ƒ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰æ–‡å³°æ‘æºªå¿ƒå¯®44ä¹‹1è™Ÿ", type: "æ™¯é»", imgUrl: "fall.jpg", link: "fall.html" },
                { id: "spot_04", name: "ç«¹å´è»Šç«™", address_search: "ç«¹å´è»Šç«™", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ç«¹å´æ‘èˆŠè»Šç«™11è™Ÿ", type: "æ™¯é»", imgUrl: "station.jpg", link: "station.html" },
                { id: "spot_05", name: "å·¦å²¸ä¼‘é–’å°ç«™", address_search: "ç«¹å´é„‰å·¦å²¸ä¼‘é–’å°ç«™", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰å¾©é‡‘æ‘6ä¹‹9è™Ÿ", lat: 23.526009639266025, lng: 120.5467074412227, type: "æ™¯é»", imgUrl: "left.jpg", link: "left.html" },
                { id: "spot_06", name: "å¥®èµ·æ¹–è€è¡—", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–", type: "æ™¯é»", imgUrl: "hu.jpg", link: "hu.html" },
                { id: "spot_07", name: "å¥®èµ·æ¹–è»Šç«™", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–103è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–103è™Ÿ", lat: 23.505550266120366, lng: 120.69515091119744, type: "æ™¯é»", imgUrl: "hustation.jpg", link: "hustation.html" },
                { id: "spot_08", name: "ç«¹å´å¤–çœéºµ", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­è¯è·¯176è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­è¯è·¯176è™Ÿ", lat: 23.52218508814462, lng: 120.54820325167819, type: "ç¾é£Ÿ", imgUrl: "noodle.jpg", link: "noodle.html" },
                { id: "spot_09", name: "æ„›å±±å±‹ï½é»‘ç³–å†°æ²™æ„›ç‰", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰107è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰107è™Ÿ", lat: 23.504950312620263, lng: 120.69450356517119, type: "ç¾é£Ÿ", imgUrl: "love.jpg", link: "love.html" },
                { id: "spot_010", name: "æšæšç”œç”œåœˆ", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰109è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰109è™Ÿ", lat: 23.50473716025952, lng: 120.69458649510192, type: "ç¾é£Ÿ", imgUrl: "yang.jpg", link: "yang.html" },
                { id: "spot_011", name: "ç™¾å¹´æªœæœ¨ç”œç”œåœˆ", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–50-2è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰ä¸­å’Œæ‘å¥®èµ·æ¹–50-2è™Ÿ", lat: 23.50374919278691, lng: 120.69501870123624, type: "ç¾é£Ÿ", imgUrl: "year.jpg", link: "year.html" },
                { id: "spot_012", name: "ç«¹å´é¹¿æ»¿å®¢å®¶æ–‡åŒ–åœ’å€", address_search: "ç«¹å´é¹¿æ»¿å®¢å®¶æ–‡åŒ–åœ’å€", address_display: "ç«¹å´é¹¿æ»¿å®¢å®¶æ–‡åŒ–åœ’å€", lat: 23.504595681240897, lng: 120.53140984313293, type: "æ™¯é»", imgUrl: "home.jpg", link: "home.html" },
                { id: "spot_013", name: "è¥¿æ–½è‚‰åœ“", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰å’Œå¹³æ‘å‘ä»”åª160-1è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰å’Œå¹³æ‘å‘ä»”åª160-1è™Ÿ", lat: 23.51569942246545, lng: 120.54806536382135, type: "ç¾é£Ÿ", imgUrl: "meat.jpg", link: "meat.html" },
                { id: "spot_014", name: "è€æ¾ç‰›è‚‰éºµ", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰é¹¿æ»¿éº»ç®•åŸ”æ®µ51ä¹‹15è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰é¹¿æ»¿éº»ç®•åŸ”æ®µ51ä¹‹15è™Ÿ", lat: 23.503042650685746, lng: 120.53742111762105, type: "ç¾é£Ÿ", imgUrl: "beef.jpg", link: "beef.html" },
                { id: "spot_015", name: "å¥®èµ·æ¹–å¤§é£¯åº—-å¥®èµ·æ¹–ä¾¿ç•¶", address_search: "å˜‰ç¾©ç¸£ç«¹å´é„‰178-1è™Ÿ", address_display: "å˜‰ç¾©ç¸£ç«¹å´é„‰178-1è™Ÿ", lat: 23.50553829769623, lng: 120.6954168786646, type: "ç¾é£Ÿ", imgUrl: "bang.jpg", link: "bang.html" }
            ];

            var $listContainer = $('.map-list');
            $listContainer.empty();

            mySpots.forEach(function (spot, index) {
                setTimeout(function () {
                    addSpotByAddress(spot);
                }, index * 200);
            });

            $('#btn-scenic').on('click', function () {
                $('.map-list_item').hide();
                $('.map-list_item').filter(function () {
                    return $(this).find('.badge').text() === "æ™¯é»";
                }).show();
            });

            $('#btn-food').on('click', function () {
                $('.map-list_item').hide();
                $('.map-list_item').filter(function () {
                    return $(this).find('.badge').text() === "ç¾é£Ÿ";
                }).show();
            });

            $('#SearchKeyword').on('keyup', function () {
                var value = $(this).val().toLowerCase();
                $(".map-list_item").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            $('#cleanAll').on('click', function () {
                $('#SearchKeyword').val('');
                $(".map-list_item").show();
            });

            console.log('âœ… ç«¹å´åœ°åœ–å·²è¼‰å…¥å®Œæˆ');
            console.log(`ğŸ“ é¡¯ç¤º ${mySpots.length} å€‹æ™¯é»ï¼ˆ${mySpots.filter(s => s.type === 'æ™¯é»').length} å€‹æ™¯é» + ${mySpots.filter(s => s.type === 'ç¾é£Ÿ').length} å€‹ç¾é£Ÿï¼‰`);
            console.log('ğŸ¬ å°è¦½åˆ—èƒŒæ™¯åœ–ç‰‡è¼ªæ’­åŠŸèƒ½å·²å•Ÿç”¨ï¼ˆä½¿ç”¨è‡ªè¨‚åœ–ç‰‡ï¼‰');
        });
    </script>

    <!-- ==================== è‡ªè¨‚å°è¦½åˆ—èƒŒæ™¯åœ–ç‰‡ ==================== -->
    <script>
        // åœ¨è¼‰å…¥ navbar-carousel.js ä¹‹å‰è¦†è“‹åœ–ç‰‡è¨­å®š
        (function () {
            // è‡ªè¨‚åœ°åœ–é é¢å°ˆç”¨çš„èƒŒæ™¯åœ–ç‰‡
            const customNavbarImages = [
                '../index_img/index_bg3.jpg',
                '../index_img/index_bg2.jpg',    // æˆ–ä½¿ç”¨ index_img ä¸­çš„åœ–ç‰‡
                '../index_img/index_bg1.jpg'
            ];

            let currentIndex = 0;
            let navbarContainer = null;
            let intervalId = null;

            function initCustomCarousel() {
                navbarContainer = document.querySelector('.navbar-image-container');

                if (!navbarContainer) {
                    console.warn('âš ï¸ æ‰¾ä¸åˆ°å°è¦½åˆ—å®¹å™¨');
                    return;
                }

                // è¨­å®šåˆå§‹èƒŒæ™¯
                if (customNavbarImages.length > 0) {
                    navbarContainer.style.backgroundImage = `url('${customNavbarImages[0]}')`;
                    navbarContainer.style.backgroundSize = 'cover';
                    navbarContainer.style.backgroundPosition = 'center';
                    navbarContainer.style.transition = 'background-image 0.5s ease-in-out';
                }

                // å•Ÿå‹•è¼ªæ’­ï¼ˆæ¯ 10 ç§’åˆ‡æ›ï¼‰
                if (customNavbarImages.length > 1) {
                    intervalId = setInterval(() => {
                        currentIndex = (currentIndex + 1) % customNavbarImages.length;
                        navbarContainer.style.backgroundImage = `url('${customNavbarImages[currentIndex]}')`;
                    }, 10000);
                }

                console.log(`âœ… åœ°åœ–é é¢å°è¦½åˆ—è¼ªæ’­å·²å•Ÿå‹•ï¼Œå…± ${customNavbarImages.length} å¼µåœ–ç‰‡`);
            }

            // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initCustomCarousel);
            } else {
                initCustomCarousel();
            }
        })();
    </script>
</body>
</html>